% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MetricsTracker.R
\name{MetricsTracker}
\alias{MetricsTracker}
\title{Metrics Tracker}
\arguments{
\item{metrics}{(\code{list})\cr
Named list of metric functions. Names become column names in the
history table. Each function should have signature
\verb{function(archive, surrogate = NULL, ...)} and return a scalar.}

\item{extra_data}{(\code{list})\cr
Additional data passed to metric functions via \code{...}. For example,
\code{list(test_data = test_dt, optimum = 0.5)}.}

\item{fun}{(\code{function})\cr
Metric function.}

\item{backfill}{(\code{logical(1)})\cr
If TRUE and there's existing history, attempt to compute the metric
for past batches. Requires archive snapshots which may not be available.}

\item{keep_data}{(\code{logical(1)})\cr
If TRUE, keep the column in the data table. Default FALSE removes it.}

\item{batch_nr}{(\code{integer(1)})\cr
The batch number to retrieve.}

\item{name}{(\code{character(1)})\cr
Name of the metric.}

\item{...}{(ignored).}

\item{metric_fun}{(\code{function}) The metric function.}

\item{archive}{(\link[bbotk:ArchiveBatch]{bbotk::ArchiveBatch}) Current archive.}

\item{surrogate}{(\link{SurrogateModel} | \link[mlr3mbo:Surrogate]{mlr3mbo::Surrogate}) Current surrogate (may be NULL).}

\item{extra_args}{(\code{list}) Extra arguments for the function.}
}
\value{
Invisibly returns the new row as a \code{data.table}.

A single-row \code{data.table}, or NULL if batch not found.

A numeric vector of metric values.

Scalar metric value.
Initialize the empty history table.
}
\description{
Tracks per-batch metrics during a search, providing the data needed for
progress monitoring, learning curve analysis, and forecasting.

Creates a new MetricsTracker.

Log metrics for a completed batch.

Add a new metric to track (for future batches).

Remove a metric from tracking.

Update extra_data used by metric functions.

Clear all logged history.

Get metrics for a specific batch.

Extract a single metric's history as a vector.

Printer.
}
\details{
The tracker stores a history table with one row per batch. Built-in columns:
\itemize{
\item \code{batch_nr}: Batch number (1-indexed)
\item \code{n_evals}: Cumulative number of evaluations
\item \code{timestamp}: When the batch was logged
}

Additional columns are computed by user-defined metric functions. These
functions receive the current state (archive, surrogate, extra data) and
return a scalar value.
}
\section{Fields}{

\describe{
\item{\code{data}}{(\code{data.table})\cr
The history table with all logged metrics.}

\item{\code{metrics}}{(\code{list})\cr
The registered metric functions.}

\item{\code{extra_data}}{(\code{list})\cr
Additional data passed to metric functions.}

\item{\code{n_batches}}{(\code{integer(1)})\cr
Number of batches logged.}

\item{\code{metric_names}}{(\code{character()})\cr
Names of all tracked metrics (excluding built-in columns).}

\item{\code{latest}}{(\code{data.table})\cr
The most recently logged row, or NULL if no history.
Compute a single metric value.}
}}

\section{Metric Functions}{

Metric functions should have signature:

\if{html}{\out{<div class="sourceCode">}}\preformatted{function(archive, surrogate = NULL, ...)
}\if{html}{\out{</div>}}

They should return a single numeric value. The \code{...} can include additional
context like test data, known optimum, etc.

See \code{search_metrics.R} for built-in metrics:
\itemize{
\item \code{metric_best_y()}: Best observed y value (optimization)
\item \code{metric_regret()}: Gap to known optimum (optimization)
\item \code{metric_model_rmse()}: Surrogate RMSE on test data (learning)
\item \code{metric_mean_variance()}: Average prediction variance (learning)
}
}

\section{Usage with Forecasters}{

The \verb{$data} field returns the complete history as a \code{data.table}, which
can be directly fed to learning curve extrapolation models. The \code{n_evals}
column serves as the x-axis (sample size) for most forecasting methods.
}

